<html>
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/0.3.18/peer.min.js"></script>
    <script>
        var peer = null
        var lastPeerId = null
        var conn = null
        function initialize() {
            peer = new Peer(null, {
                debug: 2
            });
            peer.on('open', function (id) {
                if (peer.id === null) {
                    console.log('Received null id from peer open');
                    peer.id = lastPeerId;
                } else {
                    lastPeerId = peer.id;
                }
                document.getElementById("showid").innerHTML=peer.id
                console.log("perperperperperperperperperperperperperper------open")
            });

            peer.on('connection', function (c) {
                alert("connect success")
                if (conn) {
                    c.on('open', function() {
                        c.send("Already connected to another client");
                        setTimeout(function() { c.close(); }, 500);
                    });
                    return;
                }
                console.log("perperperperperperperperperperperperperper------connection")
                conn = c //被连接时会获取到对方的通信对象
                ready()
            });
            peer.on('disconnected', function () {
                console.log("perperperperperperperperperperperperperper------disconnected")
            });
            peer.on('close', function() {
                console.log("perperperperperperperperperperperperperper------close")
            });
            peer.on('error', function (err) {
                console.log("perperperperperperperperperperperperperper------error")
            });

        }

        function connect()
        {
            if (conn) {
                conn.close();
            }

            var id = document.getElementById("connectid").value
            conn = peer.connect(id, {  //连接时会获取对方id
                reliable: true
            });
            ready()
        }

        function ready() {
            if(conn==null)return
            conn.on('open', function(){
                console.log("conconconconconconconconconconcon------open")
            });
            conn.on('data', function(data){
                // here you have conn.id
                //alert(data)
                console.log("conconconconconconconconconconcon------data:"+data)
            });
            conn.on('close', function () {
                console.log("conconconconconconconconconconcon------close")
            });
        }

        function send()
        {
            conn.send( document.getElementById("connectid").value)
        }

        initialize()
    </script>

</head>
<button onclick="connect()">connect1</button>
<button onclick="send()">Send</button>
<p id="showid"></p>
<input id="connectid"/>

</body>
</html>